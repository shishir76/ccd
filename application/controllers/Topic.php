<?php defined('BASEPATH') OR exit('No direct script access allowed');class Topic extends Admin_Core_Controller{    public function __construct()    {        parent::__construct();        //check auth        if (!is_admin())         {            redirect('login');        }        //check permission        if (!show_admin_panel())         {            redirect('admin/login');        }    }        /*** Add City */    public function add()    {        $data['title'] = trans("add_topic");        $this->load->view('admin/includes/_header', $data);        $this->load->view('admin/topics/add', $data);        $this->load->view('admin/includes/_footer');    }    /*** Add City Post */    public function add_topic()    {        //validate inputs        $this->form_validation->set_rules('topic', trans("topic"), 'required|xss_clean');		$topic = $this->input->post('topic', true);		if (!$this->question_type_model->is_unique_field($topic)) 		{		    $this->session->set_flashdata('form_data', $this->topic_model->input_values());		    $this->session->set_flashdata('error', trans("message_field_already_error"));		    redirect($this->agent->referrer());		}        if ($this->form_validation->run() === false)         {            $this->session->set_flashdata('errors', validation_errors());            $this->session->set_flashdata('form_data', $this->topic_model->input_values());            redirect($this->agent->referrer());        }         else         {            if ($this->topic_model->add())             {                $last_id = $this->db->insert_id();				$this->session->set_flashdata('success', trans("topic") . " " . trans("msg_suc_added"));                redirect($this->agent->referrer());            }             else             {                $this->session->set_flashdata('form_data', $this->topic_model->input_values());                $this->session->set_flashdata('error', trans("msg_error"));                redirect($this->agent->referrer());            }        }    }    /*** City List View */    public function listview()    {        $data['title'] = trans("topics");        $data['topics'] = $this->topic_model->get_all_topics();        $data['lang_search_column'] = 2;        $this->load->view('admin/includes/_header', $data);        $this->load->view('admin/topics/listview', $data);        $this->load->view('admin/includes/_footer');    }    /*** Update City */    public function update($id)    {        $data['title'] = trans("update_topic");        //find city        $data['topics'] = $this->topic_model->get_topic($id);        //poll not found        if (empty($data['topics']))         {            redirect($this->agent->referrer());        }        $this->load->view('admin/includes/_header', $data);        $this->load->view('admin/topics/update', $data);        $this->load->view('admin/includes/_footer');    }    /*** Update City Post */    public function update_topic()    {        //validate inputs        $this->form_validation->set_rules('topic', trans("topic"), 'required|xss_clean');	        if ($this->form_validation->run() === false)         {            $this->session->set_flashdata('errors', validation_errors());            $this->session->set_flashdata('form_data', $this->topic_model->input_values());            redirect($this->agent->referrer());        }         else         {            //get id            $id = $this->input->post('id', true);            $topic = $this->input->post('topic', true);            if (!$this->topic_model->is_unique_field($topic, $id)) {                $this->session->set_flashdata('error', trans("message_field_already_error"));                redirect($this->agent->referrer());            }                        if ($this->topic_model->update($id))             {				$this->session->set_flashdata('success', trans("topic") . " " . trans("msg_suc_updated"));                redirect('topics/listview');            }             else             {                $this->session->set_flashdata('form_data', $this->topic_model->input_values());                $this->session->set_flashdata('error', trans("msg_error"));                redirect($this->agent->referrer());            }        }    }    /*** Delete City Post */    public function delete_topic()    {        $id = $this->input->post('id', true);        $topic = $this->topic_model->get_topic($id);        if (empty($topic))         {            redirect($this->agent->referrer());        }        if ($this->topic_model->delete($id))         {            $this->session->set_flashdata('success', trans("topic") . " " . trans("msg_suc_deleted"));            redirect($this->agent->referrer());        } else         {            $this->session->set_flashdata('error', trans("msg_error"));            redirect($this->agent->referrer());        }    }}